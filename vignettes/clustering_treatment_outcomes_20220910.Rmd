---
title: "Empirically Contrasting Substance Use Disorder Treatment Outcome Definitions"
author: "Laura Brandt, Gabriel Odom, Ray Balise, and the CTN-0094 Team"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 2
    fig_width: 8
    fig_height: 8
bibliography:
  - CTNote_references.bib 
  - Brandt_Opioids.bib
nocite: '@*'
csl: addiction_vancouver.csl
vignette: >
  %\VignetteIndexEntry{CTNote Overview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<!-- output: rmarkdown::word_document -->

<!-- output: -->
<!--   rmarkdown::html_vignette: -->
<!--     toc: true -->
<!--     toc_depth: 2 -->
<!--     fig_width: 8 -->
<!--     fig_height: 8 -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, load-packages, include=FALSE}
library(CTNote)
library(readxl)
library(kableExtra)
library(ape) # dendrogram options
library(tidyverse)
```

### Abstract



# Introduction and Motivation



## Background

Over 750,000 Americans have died from a drug overdose [since 1990](https://www.hhs.gov/opioids/about-the-epidemic/opioid-crisis-statistics/index.html).[@us_hhs_opioid_2018] Not all drugs are equally to blame: opioids were implicated in 67% of preventable overdose deaths [in 2018](https://www.pewtrusts.org/en/research-and-analysis/fact-sheets/2020/12/medications-for-opioid-use-disorder-improve-patient-outcomes).[@pew_charitable_trusts_medications_2020] Less than two years later, that 67% had skyrocketed to 77%, representing 64,000 deaths.[@national_safety_council_safety_2022] To combat this public health crisis, The [National Institute on Drug Abuse](https://nida.nih.gov/)'s [Clinical Trials Network](https://nida.nih.gov/about-nida/organization/cctn/clinical-trials-network-ctn) (CTN) has funded over 100 clinical trials and clinical trial supplemental studies to study the effects of new and existing medications to treat addiction, including opioid use disorder (OUD).[@tai_nida_2021] Many of these trials were successful in discovering new theraputic strategies, and currently nearly 1.3 million Americans use methadone, buprenorphine, and/or naltrexone in medication-assisted treatment for OUD (MOUD).

In order to measure the efficacy of new MOUD therapies, clinical trial teams will choose *a priori* a collection of metrics to define a "successful" treatment. These metrics are often called "treatment endpoints" or "outcomes". A wide variety of treatment outcomes have been used in clinical trials since 1972 (Table 1 shows outcomes from 41 papers assessing MOUD).[ADD CITATIONS HERE?] These endpoints all assess participant success or failure in treatment via the results from scheduled *urine drug screenings* (UDS) or *urine opioid screenings* (UOS). Accurately measuring the efficacy of MOUD for clinical trial participants is paramount, but currently no "gold standard" trial outcomes exist.[@biondi_literature_2020]

```{r, import-table-one, include=FALSE}
pathToTable1_char <- system.file(
  "suppl_docs", "definitions_20220405.xlsx", package = "CTNote", mustWork = TRUE
)
tab1_df <- readxl::read_xlsx(pathToTable1_char) 
```

```{r, show-table-one, results='asis'}
if(!knitr::is_html_output()) {
  "TABLE OF TREATMENT ENDPOINTS HERE; SEE .html VERSION"
} else {

  tab1_df %>% 
    select(-`Frequency of UOS`, -`Coded column name`, -DOI) %>% 
    rename(
      Group = `Outcome Group`,
      Endpoint = `Primary Endpoint`,
      Class = `Numeric Class`,
      Definition = `Definition/Assessment of Outcome`,
      `Missing is` = `Missing UOS coded as`
    ) %>% 
    mutate(
      Group = case_when(
        str_detect(Group, "Abstinence") ~ "Abstinence",
        str_detect(Group, "Relapse") ~ "Relapse",
        str_detect(Group, "Reduction") ~ "Reduction",
      )
    ) %>% 
    kable("html") %>%
    column_spec(1:4, width = "3cm") %>%
    column_spec(5, width = "5cm") %>%
    kable_styling("striped", font_size = 11) %>%
    kable_minimal() %>% 
    # All styling and spec calls have to come BEFORE this line.
    scroll_box(width = "1000px", height = "500px") 
}
```

Each row of Table 1 is an outcome used in a past clinical trial for MOUD. As preliminary work, our clinical team grouped these by clinical practice into three short-term outcome classes: *abstinence*, *relapse*, and substance use *reduction*.[@us_fda_opioid_2020] Of note, these metrics also differed in how they considered a scheduled but incomplete UDS (i.e. a "missing" UDS). We removed outcomes which could not be used to measure subject-specific outcomes (e.g. "proportion of subjects in treatment group with positive UDS during study week 3"); we removed outcomes which could not yield a univariate metric of subject success (e.g. "number of positive UDS per three-week window over time"); we split papers which assessed multiple outcomes (e.g. complete abstinence between weeks 5-12 AND total number of abstinent weeks); and we combined papers which used identical outcomes. At the end of our literature search, we have `r nrow(tab1_df)` outcomes from registered clinical trials to consider.



## Objectives

> Clinically meaningful, patient-centric endpoints beyond abstinence are needed to define success in clinical trials. - Dr. Nora Vulkow, Address to CTN, April 2022

This is the first large-scale, empirical (data driven) comparison of MOUD clinical trial endpoints. Furthermore, this is the only standard and code-based library of treatment outcome definitions to date, and we believe it will be useful to all future substance use disorder clinical trials in NIDA's CTN and in other substance use disorder research. Our scientific question is as follows: When applied to the same clinical trials data, do these outcomes follow the same clinically intuitive clusters (abstinence, relapse, use reduction)?



*******************************************************************************
</br>



# Methods



## The Clinical Trials Data

The [CTN-0094 Project](http://ctndisseminationlibrary.org/protocols/ctn0094.htm) research team harmonized data from 3 large-scale MOUD clinical trials: 

- [CTN-0027](http://ctndisseminationlibrary.org/protocols/ctn0027.htm): "Starting reatment with Agonist Replacement Therapies (START)";[@saxon_buprenorphinenaloxone_2013]
- [CTN-0030](http://ctndisseminationlibrary.org/protocols/ctn0030.htm): "Prescription Opiate Abuse Treatment Study (POATS)";[@weiss_adjunctive_2011] and
- [CTN-0051](http://ctndisseminationlibrary.org/protocols/ctn0051.htm): "Extended-Release Naltrexone vs. Buprenorphine for Opioid Treatment (X:BOT)".[@lee_comparative_2018]

These three are nationally representative, prospective clinical trials with over 3600 combined participants. These trials treated participants for 16-24 weeks, and collected rich baseline substance use data, demographics, and medical/psychiatric evaluations. 

We have 3560 fully de-identified subjects with demographics and weekly UDS results for the months they were in treatment, 2492 of whom completed randomization to a treatment arm. This harmonized data will be released in the R packages `ctn0094data` and [`ctn0094DataExtra`](https://github.com/CTN-0094/ctn0094DataExtra). In order to summarize complex substance use patterns over the weeks of the multiple clinical trials, we standardized all dates to the day of trial consent, and we coded the urinalysis results for each study day/week as a quinary "word".[@odom_ctnote_2022]



## Computing Treatment Outcomes with `CTNote`

```{r, echo=FALSE}
outcomeClustersBoot_mat <- readRDS(file = "outcome_clusters.rda")
```

The software package `CTNote::` for the R computing language contains algorithms which translate urine screen results of substance use patterns into clinical trial outcomes and endpoints of interest.[@odom_ctnote_2022] By executing various combinations of these algorithms, we were able to define in computer code each of the treatment outcome definitions in Table 1. Additionally, the supplemental material of the `CTNote::` package includes a "library" of algorithms to calculate each definition listed in Table 1.

The input of each algorithm is a set of substance use pattern summaries as a quinary word for all clinical trial participants; the output of each algorithm is a calculated treatment endpoint for each participant included in the input. Now that we have an opioid-specific use pattern for each participant in these three harmonized clinical trials, and we also have a suite of computer functions to calculate each treatment endpoint, we can "cross" these two sets to calculate each endpoint for each trial participant. Each of these treatment endpoints are proxy measures for an unobserved outcome of interest (such as quality of life 5 years after treatment), but they all measure participant-specific treatment success or failure in one way or another. Note that by "treatment failure", we mean that the treatment failed to help the participant, not that the participant themselves is a failure in treatment. These clinical trials evaluated the efficiacy of treatments, not the adherence of participants to behavioral norms.

There are `r nrow(tab1_df)` composite outcomes, but a few of these outcomes involve more than one component. For example, a "time to relapse" metric would involve both the length of time from induction to the first observed relapse and an indicator if a relapse was observed. While this type of data is structurally similar to survival data [@kleinbaum_introduction_2012], we note that (unlike standard survival analysis) the censoring indicator will rarely be independent of the time-to-event measure. Counting both both "time" and "event" metrics independently, we have `r ncol(outcomeClustersBoot_mat)` distinct endpoints.



## Hierarchical Clustering Process Details

We applied each of the of `r ncol(outcomeClustersBoot_mat)` distinct MOUD treatment endpoints in our library to all 2492 participants who had been randomized to a treatment. This process enables us to empirically contrast endpoints via hierarchical clustering. Our process is as follows:

1. We calculated all `r ncol(outcomeClustersBoot_mat)` distinct endpoints for each subject, resulting in a $2492 \times `r ncol(outcomeClustersBoot_mat)`$ table of outcome metric values.
2. We scaled all "time" and "count" endpoints to be ratios of their maximum value. For example, if an endpoint measures the total number of negative UDS, then we divide this count for each participant by the maximum observed count across all participants.
3. We re-contextualized all outcomes into a "larger value is better" interpretation. That is, for outcomes where a larger numeric value would indicate a worse treatment outcome, we transformed the outcome via $f(x) = \text{max}(x) - x$.
4. To reduce the influence of a single participant's use pattern on the clustering results, we calculate the Pearson correlation matrix (using pairwise complete observations) on a bootstrap sample[@efron_introduction_1994] of the data rows defined in Step 1.
5. We perform hierarchical clustering[@bridges_hierarchical_1966] on the bootstrap correlation matrix from Step 3 using complete linkage, and cut the resulting tree into $k = 2, 3, \ldots, 15$ clusters. 
6. For each number of clusters $k$, we generate a $`r ncol(outcomeClustersBoot_mat)` \times `r ncol(outcomeClustersBoot_mat)`$ network connection matrix. The $\{i,j\}$ values of this matrix are 1 if treatment endpoints $i$ and $j$ are in the same cluster, 0 otherwise.
7. We repeat Steps 4-6 10,000 times for each $k$, and sum these matrices. In the end, a value of $\{i,j\} = 10,000$ means that in every random bootstrap sample, the treatment endpoints $i$ and $j$ are in the same cluster. Similarly, a value of $\{i,j\} = 0$ means that the treatment endpoints $i$ and $j$ are never in the same cluster for any random bootstrap sample.
8. We also performed *k*-means clustering[@macqueen_methods_1966] for each number of clusters. We found that the optimal number of clusters was $k = 3$ (by observing an "elbow" in the total within-cluster Sum of Squares plot).



*******************************************************************************
</br>



# Hierarchical Clustering Results

The bootstrap clustering results for $k = 3$ are shown in the accompanying figure.

```{r, outcome-clusters, echo=FALSE}
# Cluster
outcomes_hclust <- hclust(
  as.dist(1 - outcomeClustersBoot_mat)
)
outcomes3Clust_int <- cutree(outcomes_hclust, 3)

# Plot
colors_char <- c("#db6d00", "#490092", "#009292")
plot(
  as.phylo(outcomes_hclust),
  type = "f",
  lab4ut = "axial",
  cex = 0.7,
  tip.color = colors_char[outcomes3Clust_int],
  no.margin = TRUE
)
```



## Endpoints Cluster 1

The teal cluster on the top right of the wheel, including Shufman et al. [@shufman_efficacy_1994] and Strain et al. [@strain_dose-response_1993; @strain_comparison_1994; @strain_buprenorphine_1996; @strain_moderate-_1999] endpoints all have the following trait in common: they ignore or remove missing UDS from their calculation. Notice that this teal cluster has 0 subsplits; in every single bootstrap sample, these metrics are all clustered together. We believe that these endpoints are far too lenient, because missing UDS in opoiod trials is commonly a negative prognostic indicator [CITE THE LEADING CTN-0094 PAPER HERE].



## Endpoints Cluster 2

In contrast, the purple cluster on the bottom right of the wheel has the most variability and highest count of sub-clusters. These clusters all depend heavily on the UDS results from a single short interval. For example, the Lofwall et a. (2018) [@lofwall_weekly_2018] endpoint requires a negative UDS in week 12 (with missing UDS counted as positive), otherwise the treatment will be counted as a failure. This means that if a participant was present in the clinic with negative UDS for 11 weeks in a row, but missed the visit on week 12, the treatment would have been counted as a failure. Similarly, the Krupitsky et al. (2011) [@krupitsky_injectable_2011] endpoint requires complete abstinence from study week 5 to study week 24, and missing UDS are imputed to be positive. The endpoints in this cluster are far too harsh to be meaningful in practice, which is why the clustering results from these endpoint have so much variability (the most number of subclusters).



## Endpoints Cluster 3

The larger orange cluster on the left side of the wheel is what we have termed the "Goldilocks" cluster: these outcomes are not too lenient by ignoring missing UDS, and they are not too harsh by measuring success or failure of an entire course of treatment based on a single week or pair of weeks. Of note, our *a priori* hypothesis that these endpoints would naturally cluster into "abstinence, relapse, and use reduction" did **not** hold true. Instead, our "Goldilocks" cluster contains abstinence, relapse, and use reduction endpoints. We believe that current and future MOUD clinical trials should use outcomes from this "Goldilocks" cluster, or--if researchers have the strong desire to create a set of bespoke outcomes--new outcomes should adhere to these considerations: do not ignore missing UDS, and do not make treatment failure too sensitive to a single week's UDS.



*******************************************************************************
</br>



# Discussion

We have clustered these outcomes empirically, and we found an entire cluster only containing outcomes which ignored missing UDS--further giving credence to the theory that missing UDS are highly informative for opioid use treatment.

**NEEDS MORE LOVE HERE**



# References

