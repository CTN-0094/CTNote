<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Add numeric weights to a use pattern string"><title>Weight Visits in a Subject Use Pattern — weight_positive_visits • CTNote</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Weight Visits in a Subject Use Pattern — weight_positive_visits"><meta property="og:description" content="Add numeric weights to a use pattern string"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CTNote</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-endpoints-library">Endpoints Library</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-endpoints-library">
    <a class="dropdown-item" href="../articles/library_abstinence_20220711.html">Abstinence Outcomes</a>
    <a class="dropdown-item" href="../articles/library_reduction_20220630.html">Use Reduction Outcomes</a>
    <a class="dropdown-item" href="../articles/library_relapse_20220711.html">Relapse Outcomes</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/CTN-0094/CTNote/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Weight Visits in a Subject Use Pattern</h1>
      <small class="dont-index">Source: <a href="https://github.com/CTN-0094/CTNote/blob/HEAD/R/weight_visits.R" class="external-link"><code>R/weight_visits.R</code></a></small>
      <div class="d-none name"><code>weight_positive_visits.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Add numeric weights to a use pattern string</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">weight_positive_visits</span><span class="op">(</span></span>
<span>  <span class="va">use_pattern</span>,</span>
<span>  weights_num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`+` <span class="op">=</span> <span class="fl">1</span>, `*` <span class="op">=</span> <span class="fl">0.5</span>, o <span class="op">=</span> <span class="fl">0.22</span>, `-` <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  posPenalty_num <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  missPenalty_num <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scaleMax <span class="op">=</span> <span class="fl">120L</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>use_pattern</dt>
<dd><p>A character string showing the daily, by visit, or weekly
substance use pattern for a single subject</p></dd>


<dt>weights_num</dt>
<dd><p>A named numeric vector mapping the symbols in the use
pattern to non-negative numeric values. The default values, 1 for positive
UDS (<code>"+"</code>), 0.22 for missing UDS (<code>"o"</code>), and 0 for negative UDS
(<code>"-"</code>), are the values set in Ling et al. (1976); see the "Details"
section for more information. The default value for a mixed weekly result
(<code>"*"</code>: at least one positive and at least one negative UDS in a
single week) is the average of a positive and negative weight (0.5 by
default).</p></dd>


<dt>posPenalty_num</dt>
<dd><p>A numeric vector showing the penalty for having a
positive or mixed UDS (<code>"+"</code> or <code>"*"</code>) at each week in the use
pattern. Defaults to <code>NULL</code>, implying that a positive UDS should have
the same weight at any week in the pattern. One other useful option would
be to set the weights to increase along the length of the study protocol,
so that the penalty for having a positive UDS is grows larger the longer a
participant is in treatment. See the Examples for more information.</p></dd>


<dt>missPenalty_num</dt>
<dd><p>A numeric vector showing the penalty for having a
missing UDS (<code>"o"</code>) at each week in the use pattern. Defaults to
<code>NULL</code>, implying that a missing UDS should have the same weight at any
week in the pattern. One other useful option would be to set the weights to
decrease along the length of the study protocol, so that the penalty for
missing a clinic visit grows smaller the longer a participant has continued
in treatment.</p></dd>


<dt>scaleMax</dt>
<dd><p>Standardize the score to which maximum? Defaults to 120 to
match the scoring scale in Ling et al. (1976). See "Details" for more.</p></dd>


<dt>scale</dt>
<dd><p>Scale the resulting score to a standard maximum (given by the
<code>scaleMax</code> argument). This defaults to <code>TRUE</code>; this should not be
changed unless you are a developer and you are trying to debug your code.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A numeric value: the results of the sum of all the visit weight
values for the use pattern</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function exists to code the treatment outcome defined in Ling
et al. (1976): <a href="https://doi.org/10.1001/archpsyc.1976.01770060043007" class="external-link">doi:10.1001/archpsyc.1976.01770060043007</a>
. This definition
requires other CTNote:: functions as well, but this function was written
specifically for that definition.</p>
<p>The <code>weights_num</code> argument is the static "penalty" for positive and
missing UDS values; this will not change over the protocol weeks. These
values are then multiplied by the penalty vectors (<code>posPenalty_num</code>
and <code>missPenalty_num</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span>  <span class="va">pattern_char</span> <span class="op">&lt;-</span> <span class="st">"++o+*-------+--+-o-o-o+o+"</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co">###  Defaults  ###</span></span></span>
<span class="r-in"><span>  <span class="co"># See how the weights map to the symbols (DO NOT use in practice)</span></span></span>
<span class="r-in"><span>  <span class="fu">weight_positive_visits</span><span class="op">(</span><span class="va">pattern_char</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 1.00 1.00 0.22 1.00 0.50 0.00 0.00 0.00 0.00 0.00 0.00 0.00 1.00 0.00 0.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16] 1.00 0.00 0.22 0.00 0.22 0.00 0.22 1.00 0.22 1.00</span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># Score this use pattern via default settings</span></span></span>
<span class="r-in"><span>  <span class="fu">weight_positive_visits</span><span class="op">(</span><span class="va">pattern_char</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 41.28</span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co">###  Increase Static Weight of Missing UDS  ###</span></span></span>
<span class="r-in"><span>  <span class="co"># Because the score for a missing UDS from the Ling et al. (1976) paper was</span></span></span>
<span class="r-in"><span>  <span class="co">#   an estimated value from their data, other weights may better represent</span></span></span>
<span class="r-in"><span>  <span class="co">#   modern addiction behavior patterns. For instance, we believe that </span></span></span>
<span class="r-in"><span>  <span class="co">#   missing UDS values may be worse than a positive UDS in some instances,</span></span></span>
<span class="r-in"><span>  <span class="co">#   because they indicate that the subject is no longer participating in </span></span></span>
<span class="r-in"><span>  <span class="co">#   treatment at all. We then should change the static weights to reflect</span></span></span>
<span class="r-in"><span>  <span class="co">#   this.</span></span></span>
<span class="r-in"><span>  <span class="fu">weight_positive_visits</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">pattern_char</span>,</span></span>
<span class="r-in"><span>    weights_num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`+` <span class="op">=</span> <span class="fl">0.8</span>, `*` <span class="op">=</span> <span class="fl">0.4</span>, `o` <span class="op">=</span> <span class="fl">1</span>, `-` <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 52.8</span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co">###  Increasing Positive UDS Penalty  ###</span></span></span>
<span class="r-in"><span>  <span class="co"># Score this use pattern using an increasing positive UDS penalty (similar</span></span></span>
<span class="r-in"><span>  <span class="co">#   to that shown in Lint et al. (1976))</span></span></span>
<span class="r-in"><span>  <span class="va">newPosPenal_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    from <span class="op">=</span> <span class="fl">1</span>, to  <span class="op">=</span> <span class="fl">5</span>, </span></span>
<span class="r-in"><span>    length <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html" class="external-link">str_length</a></span><span class="op">(</span><span class="va">pattern_char</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">weight_positive_visits</span><span class="op">(</span><span class="va">pattern_char</span>, posPenalty_num <span class="op">=</span> <span class="va">newPosPenal_num</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 34.82667</span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co">###  Variable Missing UDS Penalty  ###</span></span></span>
<span class="r-in"><span>  <span class="co"># Score this use pattern using a step-down missing UDS penalty (based on</span></span></span>
<span class="r-in"><span>  <span class="co">#   the idea that missing values during the treatment induction period are</span></span></span>
<span class="r-in"><span>  <span class="co">#   much worse than missing any other time in the study)</span></span></span>
<span class="r-in"><span>  <span class="va">newMissPenal_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html" class="external-link">str_length</a></span><span class="op">(</span><span class="va">pattern_char</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">newMissPenal_num</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span></span></span>
<span class="r-in"><span>  <span class="fu">weight_positive_visits</span><span class="op">(</span><span class="va">pattern_char</span>, missPenalty_num <span class="op">=</span> <span class="va">newMissPenal_num</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 43.392</span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co">###  Composite Penalties  ###</span></span></span>
<span class="r-in"><span>  <span class="co"># Score this use pattern with both increasing positive UDS and step-down</span></span></span>
<span class="r-in"><span>  <span class="co">#   missing UDS penalties, while adjusting the weights.</span></span></span>
<span class="r-in"><span>  <span class="fu">weight_positive_visits</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">pattern_char</span>,</span></span>
<span class="r-in"><span>    weights_num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`+` <span class="op">=</span> <span class="fl">0.8</span>, `*` <span class="op">=</span> <span class="fl">0.4</span>, `o` <span class="op">=</span> <span class="fl">1</span>, `-` <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    posPenalty_num <span class="op">=</span> <span class="va">newPosPenal_num</span>,</span></span>
<span class="r-in"><span>    missPenalty_num <span class="op">=</span> <span class="va">newMissPenal_num</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 41.52941</span>
<span class="r-in"><span>  </span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://gabriel.quarto.pub/home/" class="external-link">Gabriel Odom</a>, <a href="https://www.ccny.cuny.edu/profiles/laura-brandt" class="external-link">Laura Brandt</a>, <a href="https://github.com/RaymondBalise" class="external-link">Raymond Balise</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

